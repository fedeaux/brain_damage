- prefix = "#{prefix}[<%= plural_table_name %>_attributes][0]"
- id = "brain-damage-nested-form-#{bd_id}"

%div{ :id => id }
  .brain-damage-nested-form-prototype
    %a.ui.mini.blue.corner.label.brain-damage-nested-form-remove-button
      %i.remove.icon

    = fields_for <%= singular_table_name %> do |f|
    <% for field in all_fields -%>
    <% field_description = @resource.field_description field -%>

    <% if field_description and field_description.input %>
<%= field_description.input.html.gsub(/^/, " "*6) -%>
    <% elsif field.field_type %>
      .field
        = f.label :<%= field.name %>
        = f.<%= field.field_type %> :<%= field.name %>, :name => "#{prefix}[<%= field.name %>]"

    <% end -%>
    <% end -%>

    .ui.hidden.divider

  .ui.basic.mini.fluid.button.brain-damage-nested-form-add-button
    %i.add.icon
    Add

  .ui.hidden.divider

  :coffeescript
    new BrainDamage.NestedFormControls "##{id}"
